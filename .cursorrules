# Cursor Rules for Mentra Photo Album

## プロジェクト概要
Mentra Photo Albumは、思い出を大切な人と共有するフォトアルバムアプリケーションです。
Next.js 14 (App Router) + Supabase + TypeScript + Tailwind CSSで構築されています。

## 技術スタック
- **フレームワーク**: Next.js 14 (App Router)
- **認証・データベース**: Supabase
- **UI**: shadcn/ui + Tailwind CSS
- **言語**: TypeScript 5
- **アイコン**: Lucide React
- **デザイン**: Figma (Figma Makeでコンポーネント生成)

## 開発環境
- **Node.js**: v18.18.0以上（推奨: v20以上）
- **npm**: v8以上
- **Supabase**: リモートプロジェクト

## プロジェクト構造
```
src/
├── app/                    # Next.js App Router
│   ├── (auth)/login/      # ログインページ
│   ├── albums/            # アルバム一覧・詳細
│   ├── account/           # アカウント設定
│   ├── share/             # 共有アルバム
│   └── auth/callback/     # 認証コールバック
├── components/            # Reactコンポーネント
│   ├── ui/                # shadcn/ui コンポーネント
│   └── figma/             # Figma Make生成コンポーネント
├── lib/                   # ユーティリティ
│   ├── supabase.ts        # Supabaseクライアント
│   ├── supabase-server.ts # サーバーサイドSupabase
│   ├── config.ts          # 設定（リダイレクトURL等）
│   └── auth-errors.ts     # 認証エラーハンドリング
└── types/                 # TypeScript型定義
    └── supabase.ts        # Supabase型定義（自動生成）
```

## コーディング規約

### TypeScript
- 型安全性を最優先に
- `any`型の使用は避ける
- インターフェースは明確に定義
- Supabaseの型は`src/types/supabase.ts`から自動生成

### React/Next.js
- クライアントコンポーネントには`"use client"`を明示
- サーバーコンポーネントを優先的に使用
- `useState`, `useEffect`等のフックは適切に使用
- エラーハンドリングは必ず実装

### スタイリング
- Tailwind CSSを使用
- shadcn/uiコンポーネントを活用
- レスポンシブデザインを考慮
- ダークモード対応（必要に応じて）

### ファイル命名規則
- コンポーネント: PascalCase (例: `AlbumCreator.tsx`)
- ユーティリティ: camelCase (例: `auth-errors.ts`)
- ページ: `page.tsx` (Next.js App Router)
- 型定義: `*.ts` (例: `supabase.ts`)

## Supabase連携

### 認証
- Magic Link認証を使用
- 認証エラーは`lib/auth-errors.ts`で一元管理
- リダイレクトURLは`lib/config.ts`で管理
- 認証コールバックは`app/auth/callback/page.tsx`で処理

### データベース
- RLS (Row Level Security) を有効化
- テーブル構造は`supabase/sql/`に定義
- 型定義は`npm run supabase:types`で自動生成

### Storage
- `photos`バケットを使用
- ファイル名は日本語文字をサニタイズ
- 署名付きURLを使用して画像を表示

## Figma Make連携

### コンポーネント生成
- Figma Makeで生成されたコンポーネントは`src/components/figma/`に配置
- 既存のshadcn/uiコンポーネントと統合
- 型定義を必ず追加

### デザイン準拠
- Figmaデザインを厳密に再現
- レスポンシブ対応を確認
- アクセシビリティを考慮

## 実装済み機能

### 認証
- ✅ Magic Link認証
- ✅ ログイン・ログアウト
- ✅ 認証コールバック処理
- ✅ エラーハンドリング

### プロフィール
- ✅ プロフィール設定（新規ユーザー）
- ✅ プロフィール表示
- ✅ プロフィール更新

### アルバム
- ✅ アルバム一覧表示
- ✅ アルバム作成
- ✅ アルバム詳細表示
- ✅ 写真アップロード
- ✅ 公開設定（トグル）
- ✅ アルバム削除（重複削除）

### UI/UX
- ✅ ダッシュボード（アルバム一覧）
- ✅ アルバム作成フォーム
- ✅ エラーメッセージ表示
- ✅ ローディング状態
- ✅ レスポンシブデザイン

## 実装時の注意事項

### エラーハンドリング
- すべての非同期処理にtry-catchを実装
- ユーザーフレンドリーなエラーメッセージを表示
- コンソールログは開発時のみ（本番では削除）

### パフォーマンス
- 画像の遅延読み込みを実装
- 不要な再レンダリングを避ける
- Supabaseクエリは適切にインデックスを使用

### セキュリティ
- RLSポリシーを適切に設定
- ユーザー入力は必ずサニタイズ
- ファイルアップロードはサイズ制限を設定

### データ整合性
- 外部キー制約を適切に設定
- トランザクション処理を考慮
- カスケード削除を適切に設定

## 開発フロー

### 新機能実装
1. Figmaデザインを確認
2. 必要なコンポーネントを特定
3. データベーススキーマを確認・更新
4. 型定義を更新
5. コンポーネントを実装
6. エラーハンドリングを実装
7. テスト（手動）

### バグ修正
1. エラーログを確認
2. 原因を特定
3. 修正を実装
4. エッジケースを確認
5. テスト

### データベース変更
1. `supabase/sql/`にSQLスクリプトを作成
2. マイグレーションスクリプトを実行
3. 型定義を再生成 (`npm run supabase:types`)
4. アプリケーションコードを更新

## コミット規約
- `feat:` 新機能
- `fix:` バグ修正
- `docs:` ドキュメント
- `style:` コードスタイル
- `refactor:` リファクタリング
- `test:` テスト
- `chore:` その他

## 参考ドキュメント
- `docs/` ディレクトリに詳細なドキュメント
- `README.md` にセットアップ手順
- `supabase/sql/` にデータベーススキーマ

## 禁止事項
- `any`型の使用（可能な限り）
- ハードコードされた認証情報
- コンソールログの本番コードへの残存
- 未処理のエラー
- 型定義のないコンポーネント

