# デモデータセットアップガイド

Figmaサイトと同様のプレビューを表示するためのデモデータセットアップ手順

## 📋 概要

このガイドでは、登録済みのダミーアカウントを使用して、複数のアルバムと写真が登録されている状態のプレビューを作成する方法を説明します。

## 🎯 完成イメージ

セットアップ完了後、以下が表示されます：
- ✅ 4つのアルバム（家族旅行、結婚式、サッカー部合宿、卒業式）
- ✅ 各アルバムに6-8枚の写真（合計27枚）
- ✅ Unsplashから取得した高品質な画像
- ✅ カバー画像付きのアルバムカード
- ✅ 写真の枚数表示

## 🚀 セットアップ手順

### 前提条件

1. ✅ データベーステーブルが作成済み（`01-tables-only.sql`実行済み）
2. ✅ RLSポリシーが設定済み（`02-rls-policies.sql`実行済み）
3. ✅ 少なくとも1人のユーザーがMagic Linkでログイン済み

### ステップ1: サンプルデータの投入

1. **Supabaseダッシュボード**を開く
   - https://supabase.com/dashboard

2. **SQL Editor**を開く
   - 左メニューから「SQL Editor」を選択

3. **サンプルデータを実行**
   - `supabase/sql/sample-data.sql`の内容をコピー
   - SQL Editorに貼り付け
   - 「Run」ボタンをクリック

4. **成功メッセージを確認**
   ```
   ✅ サンプルアルバムを4つ作成しました！
   ✅ サンプル写真を各アルバムに追加しました（合計27枚）！
   ```

### ステップ2: アプリケーションで確認

1. **開発サーバーを起動**
   ```bash
   npm run dev
   ```

2. **ログイン**
   - http://localhost:3000/login にアクセス
   - サンプルデータを投入したユーザーでログイン

3. **アルバム一覧を確認**
   - `/albums`ページで4つのアルバムが表示されるはずです
   - 各アルバムにカバー画像が表示されます
   - 写真の枚数が表示されます

4. **アルバム詳細を確認**
   - 任意のアルバムをクリック
   - アルバム内の写真がギャラリー形式で表示されます

## 📸 含まれる画像について

### 技術的な実装

- **画像ソース**: Unsplash（https://unsplash.com）
- **保存方法**: `storage_key`カラムに直接URLを保存
- **表示ロジック**: URLの場合は直接表示、パスの場合はSupabase Storageから取得

### 各アルバムの画像

#### 1. 家族旅行 2024 沖縄（6枚）
- 沖縄の海、ビーチ、夕暮れの景色など

#### 2. 田中家結婚式（8枚）
- 新郎新婦、ウェディングドレス、ケーキカット、チャペルなど

#### 3. サッカー部春合宿 2024（6枚）
- 試合風景、シュートシーン、チームの円陣、記念撮影など

#### 4. 大学卒業式（7枚）
- 卒業証書授与、帽子投げ、キャンパスでの思い出など

## 🛠️ トラブルシューティング

### 写真が表示されない

**症状**: アルバム一覧やアルバム詳細で写真が表示されない

**原因と解決方法**:

1. **Unsplash画像が読み込めない**
   - ブラウザのコンソールを確認
   - CORSエラーが出ている場合は、画像URLが正しいか確認
   - インターネット接続を確認

2. **RLSポリシーが設定されていない**
   - `02-rls-policies.sql`を実行してRLSを設定
   - ブラウザのコンソールで「permission denied」エラーを確認

3. **ユーザーIDが一致しない**
   - `sample-data.sql`は最後にログインしたユーザーのIDを使用
   - 別のユーザーでログインした場合、データが表示されない可能性がある
   - 解決方法: `sample-data.sql`を再実行

### アルバムは表示されるが写真が0枚

**原因**: 写真データが正常に投入されていない

**解決方法**:
1. SQL Editorで確認クエリを実行:
   ```sql
   SELECT COUNT(*) FROM public.photos WHERE uploader_id = auth.uid();
   ```
2. 0件の場合、`sample-data.sql`の写真部分のみを再実行
3. それでも解決しない場合、手動で写真データを投入

### コード変更が必要な場合

このデモデータは、以下のコード変更を前提としています：

1. **`src/app/albums/page.tsx`** (lines 95-108)
   - `storage_key`がURLの場合は直接使用
   - それ以外はSupabase Storageから取得

2. **`src/app/albums/[id]/page.tsx`** (lines 81-109)
   - 同様にURLとStorageパスを区別

これらの変更が適用されていない場合、写真が表示されません。

## 🧹 クリーンアップ

サンプルデータを削除する場合：

```sql
-- アルバムと写真を削除（CASCADE により写真も自動削除）
DELETE FROM public.albums 
WHERE owner_id = auth.uid() 
  AND id IN (
    '11111111-1111-1111-1111-111111111111',
    '22222222-2222-2222-2222-222222222222',
    '33333333-3333-3333-3333-333333333333',
    '44444444-4444-4444-4444-444444444444'
  );
```

## 📝 本番環境での注意点

⚠️ **重要**: このサンプルデータは開発環境でのテスト用です。

本番環境では：
- ✅ 実際のファイルをSupabase Storageにアップロード
- ✅ `storage_key`にはStorageのパスを保存（例: `user123/album456/photo.jpg`）
- ❌ 外部URL（Unsplash等）を直接`storage_key`に保存しない
- ❌ サンプルデータを本番DBに投入しない

## 🔗 参考リンク

- [サンプルデータSQL](../../supabase/sql/sample-data.sql)
- [データベースセットアップガイド](./DATABASE_SETUP.md)
- [セットアップガイド](./SETUP_GUIDE.md)
- [Unsplash](https://unsplash.com)

## 📊 データ統計

| アルバム | 写真枚数 | カテゴリ |
|---------|---------|---------|
| 家族旅行 2024 沖縄 | 6枚 | 家族 |
| 田中家結婚式 | 8枚 | 結婚式 |
| サッカー部春合宿 2024 | 6枚 | スポーツ |
| 大学卒業式 | 7枚 | イベント |
| **合計** | **27枚** | - |

## ✅ チェックリスト

セットアップ完了前に以下を確認してください：

- [ ] データベーステーブルが作成されている
- [ ] RLSポリシーが設定されている
- [ ] 少なくとも1人のユーザーがログイン済み
- [ ] `sample-data.sql`が正常に実行された
- [ ] アルバム一覧ページで4つのアルバムが表示される
- [ ] 各アルバムにカバー画像が表示される
- [ ] アルバム詳細ページで写真が表示される
- [ ] 写真の枚数が正しく表示される

全てチェックが完了したら、デモデータのセットアップは完了です！🎉

