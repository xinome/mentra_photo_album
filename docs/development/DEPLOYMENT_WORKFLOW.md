# デプロイ運用フロー

## 📋 概要

Vercelのデプロイ使用量制限を考慮し、デプロイ回数を最小限に抑えるための運用フローです。

## ✅ デプロイ前チェックリスト

### 1. ローカルでの型チェック
```bash
npm run type-check
```
- TypeScriptの型エラーがないことを確認
- エラーがある場合は修正してから次へ

### 2. ローカルでのビルド確認
```bash
npm run build
```
- ビルドが成功することを確認
- エラーがある場合は修正してから次へ

### 3. ローカルでの動作確認
```bash
npm run dev
```
- 開発サーバーで動作確認
- 主要な機能が正常に動作することを確認

### 4. コミット前の確認
- 変更内容を確認
- 不要なファイルが含まれていないか確認
- コミットメッセージが適切か確認

## 🚀 デプロイフロー

### 通常の開発フロー

1. **機能実装**
   - ローカルで開発
   - 型チェック・ビルド確認を実施

2. **コミット**
   - 機能単位でコミット
   - コミットメッセージは明確に

3. **プッシュ**
   - `main`ブランチに直接プッシュ
   - Vercelが自動デプロイを開始

### ブランチ戦略（推奨）

1. **機能ブランチを作成**
   ```bash
   git checkout -b feature/account-settings
   ```

2. **開発・テスト**
   - ローカルで型チェック・ビルド確認
   - 動作確認

3. **プルリクエスト作成**
   - GitHubでプルリクエストを作成
   - Vercelがプレビューデプロイを自動生成
   - プレビューで動作確認

4. **マージ**
   - 問題なければマージ
   - `main`ブランチに自動デプロイ

## 🔧 トラブルシューティング

### ビルドエラーが発生した場合

1. **ローカルで再現**
   ```bash
   npm run build
   ```

2. **エラー内容を確認**
   - 型エラーの場合は型定義を確認
   - 依存関係の問題の場合は`node_modules`を削除して再インストール

3. **修正後、再度ビルド確認**
   ```bash
   npm run build
   ```

4. **問題なければコミット・プッシュ**

### デプロイが失敗した場合

1. **Vercelのログを確認**
   - エラーメッセージを確認
   - どのステップで失敗したか確認

2. **ローカルで再現**
   - 同じエラーが発生するか確認

3. **修正**
   - エラーを修正
   - ローカルでビルド確認

4. **再デプロイ**
   - 修正をコミット・プッシュ

## 📝 ベストプラクティス

### 1. 小さなコミットを心がける
- 1つの機能や修正ごとにコミット
- デプロイエラー時の原因特定が容易

### 2. 型エラーは即座に修正
- 型エラーを放置しない
- 開発中に型チェックを実行

### 3. ビルド確認を習慣化
- コミット前に必ずビルド確認
- エラーがあれば修正してからコミット

### 4. プレビューデプロイを活用
- プルリクエストでプレビューデプロイを生成
- 本番デプロイ前に動作確認

### 5. デプロイ頻度の管理
- 1日あたりのデプロイ回数を把握
- 重要な機能のみ本番デプロイ
- 細かい修正はまとめてデプロイ

## 🛠️ 便利なコマンド

### 型チェックのみ実行
```bash
npm run type-check
```

### ビルド確認のみ実行
```bash
npm run build
```

### 型チェック + ビルド確認
```bash
npm run pre-deploy
```

### 開発サーバー起動
```bash
npm run dev
```

## 📊 デプロイ回数の目安

- **1日あたり**: 3-5回程度
- **1週間あたり**: 15-20回程度
- **重要な機能**: 即座にデプロイ
- **細かい修正**: まとめてデプロイ

## ⚠️ 注意事項

- デプロイ前に必ずローカルでビルド確認
- 型エラーは放置しない
- デプロイ回数が多くなりすぎないよう注意
- プレビューデプロイを活用して本番デプロイを減らす

